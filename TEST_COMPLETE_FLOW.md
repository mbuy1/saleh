# ๐งช ุงุฎุชุจุงุฑ ุงูุชุฏูู ุงููุงูู - ุฅูุดุงุก ูุชุฌุฑ ูููุชุฌ

## โ ูุง ุชู ุฅุตูุงุญู:

### 1. ูุงุนุฏุฉ ุงูุจูุงูุงุช:
- โ ุฅุถุงูุฉ ุนููุฏ `store_id` ูุฌุฏูู `user_profiles`
- โ ูุฒุงููุฉ ุงูุจูุงูุงุช ุงููุฏููุฉ
- โ ุฅูุดุงุก Triggers ุชููุงุฆูุฉ

### 2. Worker Code:
- โ Version: `f63498d9-1800-467d-b265-fe4bee73332d`
- โ URL: `https://misty-mode-b68b.baharista1.workers.dev`
- โ ุงูููุฏ ุตุญูุญ: ูุญุฏุซ `store_id` ุนูุฏ ุฅูุดุงุก ูุชุฌุฑุ ูููุฑุฃู ุนูุฏ ุฅูุดุงุก ููุชุฌ

---

## ๐ ุณููุงุฑูููุงุช ุงูุงุฎุชุจุงุฑ:

### ุณููุงุฑูู 1: ุชุงุฌุฑ ูุฏูู ูุชุฌุฑ ุจุงููุนู โ
**ุงููุถุน:** ุชุงุฌุฑ ูุงู ุจุฅูุดุงุก ูุชุฌุฑ ูู ูุจู (ุชู ุชุญุฏูุซ `store_id` ุจุงูู Migration)

**ุงูุงุฎุชุจุงุฑ:**
1. ุณุฌู ุฏุฎูู ูู Merchant
2. ุงุฐูุจ ุฅูู ุตูุญุฉ ุงูููุชุฌุงุช
3. ุงุถุบุท "ุฅุถุงูุฉ ููุชุฌ ุฌุฏูุฏ"
4. ุงููุฃ ุจูุงูุงุช ุงูููุชุฌ
5. ุงุถุบุท "ุญูุธ"

**ุงููุชูุฌุฉ ุงููุชููุนุฉ:**
โ ูุชู ุฅูุดุงุก ุงูููุชุฌ ูุจุงุดุฑุฉ ุจุฏูู ุฃู ุฎุทุฃ

---

### ุณููุงุฑูู 2: ุชุงุฌุฑ ุฌุฏูุฏ ุจุฏูู ูุชุฌุฑ
**ุงููุถุน:** ุชุงุฌุฑ ุฌุฏูุฏ ูู ููุดุฆ ูุชุฌุฑ ุจุนุฏ

**ุงูุงุฎุชุจุงุฑ:**
1. ุณุฌู ุฏุฎูู ูู Merchant ุฌุฏูุฏ
2. ุงุฐูุจ ุฅูู ุตูุญุฉ ุงูููุชุฌุงุช
3. ุงุถุบุท "ุฅุถุงูุฉ ููุชุฌ ุฌุฏูุฏ"

**ุงููุชูุฌุฉ ุงููุชููุนุฉ:**
โ๏ธ ุฑุณุงูุฉ: "ูุฌุจ ุฅูุดุงุก ูุชุฌุฑ ุฃููุงู ูุจู ุฅุถุงูุฉ ุงูููุชุฌุงุช"

**ุซู:**
4. ุงุฐูุจ ุฅูู ุตูุญุฉ ุงููุชุฌุฑ
5. ุงุถุบุท "ุฅูุดุงุก ูุชุฌุฑ"
6. ุงููุฃ ุจูุงูุงุช ุงููุชุฌุฑ
7. ุงุถุบุท "ุญูุธ"

**ุงููุชูุฌุฉ ุงููุชููุนุฉ:**
โ ูุชู ุฅูุดุงุก ุงููุชุฌุฑ
โ ูุชู ุชุญุฏูุซ `user_profiles.store_id` ุชููุงุฆูุงู (Trigger)

**ุซู:**
8. ุงุฑุฌุน ูุตูุญุฉ ุงูููุชุฌุงุช
9. ุงุถุบุท "ุฅุถุงูุฉ ููุชุฌ ุฌุฏูุฏ"
10. ุงููุฃ ุจูุงูุงุช ุงูููุชุฌ
11. ุงุถุบุท "ุญูุธ"

**ุงููุชูุฌุฉ ุงููุชููุนุฉ:**
โ ูุชู ุฅูุดุงุก ุงูููุชุฌ ุจูุฌุงุญ

---

### ุณููุงุฑูู 3: ุงูุชุญูู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
**ุงูุชุญูู ูู ุงููุฒุงููุฉ ุงูุตุญูุญุฉ:**

```sql
-- ุชุญูู ูู ุฃู ุฌููุน ุงูุชุฌุงุฑ ูุฏููู store_id
SELECT 
  up.email,
  up.store_id AS "store_id ูู user_profiles",
  s.id AS "store_id ูู stores",
  s.name AS "ุงุณู ุงููุชุฌุฑ",
  CASE 
    WHEN up.store_id = s.id THEN 'โ ูุชุฒุงูู'
    WHEN up.store_id IS NULL THEN 'โ๏ธ ูุง ููุฌุฏ store_id'
    ELSE 'โ ุบูุฑ ูุชุทุงุจู'
  END AS "ุงูุญุงูุฉ"
FROM public.user_profiles up
LEFT JOIN public.stores s ON s.owner_id = up.id
WHERE up.role = 'merchant'
ORDER BY up.email;
```

**ุงููุชูุฌุฉ ุงููุชููุนุฉ:**
- ุฌููุน ุงูุชุฌุงุฑ ุงูุฐูู ูุฏููู ูุชุงุฌุฑ: โ ูุชุฒุงูู
- ุงูุชุฌุงุฑ ุงูุฌุฏุฏ ุจุฏูู ูุชุงุฌุฑ: โ๏ธ ูุง ููุฌุฏ store_id (ุทุจูุนู)

---

## ๐ ุงูุชุฏูู ุงูุชููู:

### ุนูุฏ ุฅูุดุงุก ูุชุฌุฑ:
```
1. Flutter App โ POST /stores/create
2. Worker: ูุชุญูู ูู ุตูุงุญูุงุช Merchant
3. Worker: ููุดุฆ ูุชุฌุฑ ูู ุฌุฏูู stores
4. Worker: ูุญุฏุซ user_profiles.store_id (ูุฏููุงู ูู ุงูููุฏ)
5. Database Trigger: ูุญุฏุซ user_profiles.store_id (ุชููุงุฆูุงู ูู backup)
6. Worker: ูุฑุฌุน ุจูุงูุงุช ุงููุชุฌุฑ
```

### ุนูุฏ ุฅูุดุงุก ููุชุฌ:
```
1. Flutter App โ POST /products/create
2. Worker: ูุชุญูู ูู ุตูุงุญูุงุช Merchant
3. Worker: ููุฑุฃ store_id ูู user_profiles
4. IF store_id ููุฌูุฏ:
   โ ููุดุฆ ุงูููุชุฌ
5. IF store_id ูุงุฑุบ:
   โ ูุฑุฌุน ุฎุทุฃ "ูุฌุจ ุฅูุดุงุก ูุชุฌุฑ ุฃููุงู"
```

---

## ๐ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก:

### ุฅุฐุง ูุดู ุฅูุดุงุก ุงูููุชุฌ ูุน ูุฌูุฏ ูุชุฌุฑ:

**1. ุชุญูู ูู store_id ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช:**
```sql
SELECT id, email, role, store_id
FROM public.user_profiles
WHERE email = 'ุงูุจุฑูุฏ_ุงูุฅููุชุฑููู_ููุชุงุฌุฑ';
```

**2. ุฅุฐุง ูุงู store_id = NULL:**
```sql
-- ูู ุจุงููุฒุงููุฉ ูุฏููุงู
UPDATE public.user_profiles up
SET store_id = s.id, updated_at = NOW()
FROM public.stores s
WHERE s.owner_id = up.id
  AND up.id = 'USER_PROFILE_ID_HERE';
```

**3. ุชุญูู ูู Worker logs:**
- ุงูุชุญ Cloudflare Dashboard
- Workers & Pages โ misty-mode-b68b โ Logs
- ุงุจุญุซ ุนู ุฃุฎุทุงุก ูู `createProduct`

**4. ุชุญูู ูู Flutter logs:**
- ูู VS Code Terminal
- ุงุจุญุซ ุนู response ูู `/products/create`

---

## ๐ ูุชุงุฆุฌ ุงูุงุฎุชุจุงุฑ:

### โ ูุงุฌุญ:
- [ ] ุชุงุฌุฑ ูุฏูู ูุถูู ููุชุฌ ุจูุฌุงุญ
- [ ] ุชุงุฌุฑ ุฌุฏูุฏ ูุญุตู ุนูู ุฑุณุงูุฉ "ุฅูุดุงุก ูุชุฌุฑ ุฃููุงู"
- [ ] ุชุงุฌุฑ ุฌุฏูุฏ ููุดุฆ ูุชุฌุฑ ุจูุฌุงุญ
- [ ] ุชุงุฌุฑ ุฌุฏูุฏ ูุถูู ููุชุฌ ุจุนุฏ ุฅูุดุงุก ุงููุชุฌุฑ
- [ ] store_id ูู user_profiles ูุชุฒุงูู ูุน stores

### โ ูุดู:
ุฅุฐุง ูุดู ุฃู ุงุฎุชุจุงุฑุ ุณุฌู ุงูุชูุงุตูู ููุง:
```
ุงูุงุฎุชุจุงุฑ ุงููุงุดู: _________________
ุฑุณุงูุฉ ุงูุฎุทุฃ: _____________________
ุชูุงุตูู ุฅุถุงููุฉ: __________________
```

---

## ๐ฏ ุงูููุฎุต ุงูููุงุฆู:

**ูุจู ุงูุฅุตูุงุญ:**
โ Worker ูุจุญุซ ุนู ุนููุฏ ุบูุฑ ููุฌูุฏ
โ ุฏุงุฆุฑุฉ ูุง ูุชูุงููุฉ ูู ุงูุฃุฎุทุงุก

**ุจุนุฏ ุงูุฅุตูุงุญ:**
โ ุงูุนููุฏ ููุฌูุฏ ูู Database
โ Worker Code ุตุญูุญ
โ Triggers ุชููุงุฆูุฉ ูููุฒุงููุฉ
โ ุงูุจูุงูุงุช ุงููุฏููุฉ ูุชุฒุงููุฉ

**ุงูุฎูุงุตุฉ:**
ุงููุดููุฉ ูุงูุช ูู **ูุณุชูู ุงูุจููุฉ ุงูุชุญุชูุฉ** ูููุณ ูู ุงูููุทู!
